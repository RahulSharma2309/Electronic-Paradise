---
# Secrets for Staging Environment
# Secrets store sensitive data like passwords and connection strings
# NOTE: In production, use proper secret management (Azure Key Vault, AWS Secrets Manager, etc.)
#
# IMPORTANT: This configuration connects to your LOCAL SQL Server (not Docker container)
# - host.docker.internal resolves to the host machine from inside K8s pods (Docker Desktop)
# - Make sure SQL Server is running and accepting TCP/IP connections on port 1433
# - Run infra/sql/setup-databases.sql in SSMS to create the staging databases

# Database Secret (shared by all services)
apiVersion: v1
kind: Secret
metadata:
  name: database-secret
  namespace: staging
  labels:
    app: database
    environment: staging
    managed-by: freshharvest-market
type: Opaque
stringData:
  # Database connection details - connects to HOST SQL Server (not Docker)
  # host.docker.internal = your Windows machine from inside K8s
  DB_SERVER: "host.docker.internal"
  DB_PORT: "1433"
  DB_USER: "sa"
  DB_PASSWORD: "Your_password123"
  DB_TRUST_CERT: "True"

---
# Auth Service Database Secret
apiVersion: v1
kind: Secret
metadata:
  name: auth-service-db-secret
  namespace: staging
  labels:
    app: auth-service
    environment: staging
    managed-by: freshharvest-market
type: Opaque
stringData:
  # Connects to EP_Staging_AuthDb on your local SQL Server
  ConnectionStrings__DefaultConnection: "Server=host.docker.internal,1433;Database=EP_Staging_AuthDb;User Id=sa;Password=Your_password123;TrustServerCertificate=True;"

---
# User Service Database Secret
apiVersion: v1
kind: Secret
metadata:
  name: user-service-db-secret
  namespace: staging
  labels:
    app: user-service
    environment: staging
    managed-by: freshharvest-market
type: Opaque
stringData:
  # Connects to EP_Staging_UserDb on your local SQL Server
  ConnectionStrings__DefaultConnection: "Server=host.docker.internal,1433;Database=EP_Staging_UserDb;User Id=sa;Password=Your_password123;TrustServerCertificate=True;"

---
# Product Service Database Secret
apiVersion: v1
kind: Secret
metadata:
  name: product-service-db-secret
  namespace: staging
  labels:
    app: product-service
    environment: staging
    managed-by: freshharvest-market
type: Opaque
stringData:
  # Connects to EP_Staging_ProductDb on your local SQL Server
  ConnectionStrings__DefaultConnection: "Server=host.docker.internal,1433;Database=EP_Staging_ProductDb;User Id=sa;Password=Your_password123;TrustServerCertificate=True;"

---
# Order Service Database Secret
apiVersion: v1
kind: Secret
metadata:
  name: order-service-db-secret
  namespace: staging
  labels:
    app: order-service
    environment: staging
    managed-by: freshharvest-market
type: Opaque
stringData:
  # Connects to EP_Staging_OrderDb on your local SQL Server
  ConnectionStrings__DefaultConnection: "Server=host.docker.internal,1433;Database=EP_Staging_OrderDb;User Id=sa;Password=Your_password123;TrustServerCertificate=True;"

---
# Payment Service Database Secret
apiVersion: v1
kind: Secret
metadata:
  name: payment-service-db-secret
  namespace: staging
  labels:
    app: payment-service
    environment: staging
    managed-by: freshharvest-market
type: Opaque
stringData:
  # Connects to EP_Staging_PaymentDb on your local SQL Server
  ConnectionStrings__DefaultConnection: "Server=host.docker.internal,1433;Database=EP_Staging_PaymentDb;User Id=sa;Password=Your_password123;TrustServerCertificate=True;"
